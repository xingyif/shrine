"bundle";"use strict";System.register("includes-polyfill.js",[],function(a,b){var c;return{setters:[],execute:function(){a("stringIncludesPolyfill",c=function(){String.prototype.includes||(String.prototype.includes=function(a,b){return"number"!=typeof b&&(b=0),!(b+a.length>this.length)&&this.indexOf(a,b)!==-1})}),a("stringIncludesPolyfill",c)}}}),System.register("main.js",["./includes-polyfill"],function(a,b){function c(a){a.use.standardConfiguration().developmentLogging().feature("resources").feature("views"),a.start().then(d).then(function(){return a.setRoot("shell")})}var d;return a("configure",c),{setters:[function(a){d=a.stringIncludesPolyfill}],execute:function(){}}}),System.register("resources/converters/box-style.converter.js",[],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("BoxStyleValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){return"transform: translate("+String(-100*a)+"%);"},a}()),a("BoxStyleValueConverter",d)}}}),System.register("resources/converters/count-value-converter.js",[],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("CountValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){return a<0?"10 patients or fewer":a+" +-10 patients"},a}()),a("CountValueConverter",d)}}}),System.register("resources/converters/datetime.value.converter.js",["moment"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a.default}],execute:function(){a("DateTimeValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a){return d(a).format("MM/DD/YYYY h:mm:ss a")},a}()),a("DateTimeValueConverter",e)}}}),System.register("resources/converters/result-style.converter.js",[],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("ResultStyleValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){var b=this.isUnresolved(a)?"color:"+this.getColorValue(a):"";return b},a.prototype.isUnresolved=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FINISHED";return!a||a.status!==b},a.prototype.getColorValue=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ERROR",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#FF0000",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#00FF00";return a&&a.status!==b?d:c},a}()),a("ResultStyleValueConverter",d)}}}),System.register("resources/converters/result-value.converter.js",[],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("ResultValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){return a?"FINISHED"!==a.status?"":a.count<0?"<=10":a.count:"not available"},a}()),a("ResultValueConverter",d)}}}),System.register("resources/converters/truncate.converter.js",[],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("TruncateValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){var b=20;return a.length>b?a.substring(0,b)+"...":a},a}()),a("TruncateValueConverter",d)}}}),function(){var a=System.amdDefine;a("resources/custom/breakdown/breakdown.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div style="clear: both; margin-left: 30px; float: left; height: 16px; line-height: 16px"><br><font>${data.resultType.i2b2Options.description}:</font></div><div style="clear: both; margin-left: 40px; float: left; height: 16px; line-height: 16px"></div><div repeat.for="result of data.results" style="clear: both; margin-left: 40px; float: left; height: 16px; line-height: 16px">${result.dataKey}: <font color="#0000dd">${result.value | count}</font></div></template>'})}(),System.register("resources/custom/breakdown/breakdown.js",["aurelia-framework"],function(a,b){function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l;return{setters:[function(a){f=a.bindable,g=a.customElement}],execute:function(){a("Breakdown",(h=g("breakdown"),l=h((j=function a(){d(this,a),c(this,"data",k,this)},k=e(j.prototype,"data",[f],{enumerable:!0,initializer:null}),i=j))||i)),a("Breakdown",l)}}}),function(){var a=System.amdDefine;a("resources/custom/node-result/error.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>&nbsp;- <span><b><a class="query-error-anchor" href="#" style="color:#ff0000" click.delegate="publish(commands.i2b2.showError, result)"><b><span color="#ff0000">${result.statusMessage}</span></b></a></b></span></template>'})}(),function(){var a=System.amdDefine;a("resources/custom/node-result/node-result.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div style="clear:both"><br><div style="float:left; font-weight:bold; margin-left:20px">${result.adapterNode} "${queryName}"</div></div><compose view.bind="component"></compose></template>'})}(),System.register("resources/custom/node-result/node-result.js",["aurelia-framework","services/pub-sub"],function(a,b){function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var h,i,j,k,l,m,n,o,p;return{setters:[function(a){h=a.customElement,i=a.bindable},function(a){j=a.PubSub}],execute:function(){a("NodeResult",(k=h("node-result"),p=k((m=function(a){function b(){d(this,b);for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=e(this,a.call.apply(a,[this].concat(g)));return c(i,"result",n,i),c(i,"queryName",o,i),i}return f(b,a),b.prototype.attached=function(){var a=this.result.status;this.component="./submitted.html","ERROR"===a?this.component="./error.html":"COMPLETED,FINISHED".includes(a)?this.component="./patient-count.html":"PROCESSING,INCOMPLETE,COMPLETE".includes(a)?this.component="./status.html":a.toLowerCase().includes("queue")&&(this.component="./queued.html")},b}(j),n=g(m.prototype,"result",[i],{enumerable:!0,initializer:null}),o=g(m.prototype,"queryName",[i],{enumerable:!0,initializer:null}),l=m))||l)),a("NodeResult",p)}}}),function(){var a=System.amdDefine;a("resources/custom/node-result/patient-count.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div style="clear: both; margin-left: 30px; float: left; height: 16px; line-height: 16px">Patient Count: <font color="#0000dd">- ${result.count | count}</font></div><breakdown repeat.for="breakdown of result.breakdowns" data.one-way="breakdown"></breakdown></template>'})}(),function(){var a=System.amdDefine;a("resources/custom/node-result/queued.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>&nbsp;- <span style="color: #000">QUEUED</span></template>'})}(),function(){var a=System.amdDefine;a("resources/custom/node-result/status.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>&nbsp;- <span style="color: #000">${result.status}</span></template>'})}(),function(){var a=System.amdDefine;a("resources/custom/node-result/submitted.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>&nbsp;-<span style="color: #00dd00">SUBMITTED</span></template>'})}(),function(){var a=System.amdDefine;a("resources/custom/node-status/node-status.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div style="display: flex"><div style="flex:1">${result.adapterNode}</div><div style="flex: 1"><span if.one-way="\'STATUS,FINISHED,COMPLETE\'.includes(result.status)" style="display: inline-block; color: #0000dd"><span style="color: black">COMPLETED</span> </span><span if.one-way="\'PROCESSING,INCOMPLETE\'.includes(result.status)" style="display: inline-block; color: #0000dd"><span style="color: black">${result.status}</span> </span><span if.one-way="result.status.toLowerCase().includes(\'queue\')"><span style="color: black">QUEUED</span> </span><span><a if.one-way="result.status === \'ERROR\'" class="query-error-anchor" href="#" style="color:#ff0000" click.delegate="publish(commands.i2b2.showError, result)">ERROR </a></span><span if.one-way="result.status.toLowerCase().includes(\'submit\')"><span style="color: #00FF00">SUBMITTED</span></span></div><div style="flex:1"><span if.one-way="\'STATUS,FINISHED,COMPLETE\'.includes(result.status)" style="display: inline-block; color: #0000dd">Patient Count:&nbsp;${result.count | count}</span></div></div></template>'})}(),System.register("resources/custom/node-status/node-status.js",["aurelia-framework","services/pub-sub"],function(a,b){function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var h,i,j,k,l,m,n,o;return{setters:[function(a){h=a.customElement,i=a.bindable},function(a){j=a.PubSub}],execute:function(){a("NodeStatus",(k=h("node-status"),o=k((m=function(a){function b(){d(this,b);for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=e(this,a.call.apply(a,[this].concat(g)));return c(i,"result",n,i),i}return f(b,a),b}(j),n=g(m.prototype,"result",[i],{enumerable:!0,initializer:null}),l=m))||l)),a("NodeStatus",o)}}}),function(){var a=System.amdDefine;a("resources/custom/node-status/temp.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<div style="display: flex"><div style="flex:1">${result.adapterNode}</div><div style="flex: 1"><span if.one-way="result.statusMessage === \'COMPLETED\' || result.statusMessage === \'FINISHED\'" style="display: inline-block; color: #0000dd">&nbsp; <span style="color: black">${result.statusMessage}</span> </span><span>&nbsp; <a if.one-way="result.statusMessage === \'ERROR\'" class="query-error-anchor" href="#" style="color:#ff0000" click.delegate="publish(commands.i2b2.showError, result)">ERROR: ${result.statusDescription} </a></span><span if.one-way="[\'ERROR\',\'COMPLETED\',\'FINISHED\'].indexOf(result.statusMessage) === -1">&nbsp; <span style="color: #00dd00">${result.statusMessage}</span></span></div><div style="flex:1"><span if.one-way="result.statusMessage === \'COMPLETED\' || result.statusMessage === \'FINISHED\'" style="display: inline-block; color: #0000dd">&nbsp; ${result.count | count}</span></div></div><patient-count if.one-way="result.statusMessage === \'COMPLETED\' || result.statusMessage === \'FINISHED\'" result.one-way="result"><div style="clear: both; margin-left: 30px; float: left; height: 16px; line-height: 16px">Patient Count: <font color="#0000dd">- ${result.count | count}</font></div></patient-count><error if.one-way="result.statusMessage === \'ERROR\'" result.one-way="result">&nbsp;- <span title="${result.statusDescription}"><b><a class="query-error-anchor" href="#" style="color:#ff0000" click.delegate="publish(commands.i2b2.showError, result)"><b><span color="#ff0000">ERROR: ${result.statusDescription}</span></b></a></b></span></error><span if.one-way="[\'ERROR\',\'COMPLETED\',\'FINISHED\'].indexOf(result.statusMessage) === -1">&nbsp;- <span style="color: #00dd00">${result.statusMessage}</span></span>'})}(),System.register("resources/index.js",[],function(a,b){function c(a){var b="converters",c=["box-style.converter","count-value-converter","datetime.value.converter","result-style.converter","result-value.converter","truncate.converter"];a.globalResources.apply(a,c.map(function(a){return"./"+b+"/"+a}));var d="custom",e=["breakdown/breakdown","node-result/node-result","node-status/node-status"];a.globalResources.apply(a,e.map(function(a){return"./"+d+"/"+a}))}return a("configure",c),{setters:[],execute:function(){}}}),System.register("services/queries.model.js",["aurelia-event-aggregator","repository/qep.repository","./shrine.messages"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.EventAggregator},function(a){e=a.QEPRepository},function(a){f=a.notifications}],execute:function(){a("QueriesModel",(h=g=function a(b,d,e){var f=this;c(this,a);var g=d,h=40,i=0,j=0,k=null;a.prototype.load=function(){return g.fetchPreviousQueries(f.maxQueriesPerFetch()+f.loadedCount()).then(function(a){return j=a.rowCount,i=a.queryResults.length,a}).catch(function(a){return console.log(a)}).then(l).then(function(a){k=a,b.publish(e.shrine.queriesReceived,k)})},a.prototype.totalQueries=function(){return j},a.prototype.loadedCount=function(){return i},a.prototype.maxQueriesPerFetch=function(){return h},a.prototype.moreToLoad=function(){return i<j},a.prototype.hasData=function(){return null!==k&&void 0!==k};var l=function(a){arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return new Promise(function(b,c){for(var d=[],e=6,f=a.adapters,g=f.length,h=a.queryResults,i=0;i<g;i+=e){var j=m(f,i,e),k=f.slice(i,j),l=n(k,h);d.push({nodes:k,results:l})}b(d)})},m=function(a,b,c){var d=b+c;return d<a.length?d:a.length},n=function(a,b){var c=[];return b.forEach(function(b,d){var e={name:b.query.queryName,id:b.query.networkId,date:b.query.dateCreated,flagged:b.query.flagged===!0,flagMessage:b.query.flagMessage||null,nodeResults:[],status:b.adaptersToResults.reduce(function(a,c){var d="FINISHED"===c.status?a.finished+1:a.finished,e="ERROR"===c.status?a.error+1:a.error;return{error:e,finished:d,total:b.adaptersToResults.length}},{error:0,finished:0,total:b.adaptersToResults.length})};a.forEach(function(a){e.nodeResults.push(b.adaptersToResults.find(function(b){return b.adapterNode===a}))}),c.push(e)}),c}},g.inject=[d,e,f],i=h)),a("QueriesModel",i)}}}),function(){var a=System.amdDefine;a("shell.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return"<template><query-status></query-status></template>"})}(),System.register("services/container.js",["ramda"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f;return{setters:[function(a){d=a}],execute:function(){e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Container",f=function(){function a(b){c(this,a),this.__value=b}return a.of=function(b){return new a(function(){return b})},a.prototype.map=function(b){return this.hasNothing()?a.of(null):a.of(b(this.value))},a.prototype.join=function(){return this.hasNothing()?a.of(null):this.value},a.prototype.chain=function(a){return this.map(a).join()},a.prototype.hasNothing=function(){return null===this.value||void 0===this.value},a.prototype.ap=function(a){a.map(this.value)},e(a,[{key:"value",get:function(){return this.__value()}}]),a}()),a("Container",f)}}}),System.register("services/i2b2.service.js",["ramda","./container"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a},function(a){e=a.Container}],execute:function(){a("I2B2Service",(g=f=function a(b){c(this,a);var f=b?e.of(b):e.of(null),g=d.curry(function(a,b){return b.value?e.of(d.prop(a,b.value)):e.of(null)}),h=d.compose(g("i2b2"),g("window"),g("parent")),i=d.compose(g("CRC"),h),j=d.compose(g("events"),h),k=d.compose(g("SHRINE"),h);a.prototype.onResize=function(a){return j(f).map(function(b){return b.changedZoomWindows.subscribe(a)})},a.prototype.onHistory=function(a){return i(f).map(function(b){return b.ctrlr.history.events.onDataUpdate.subscribe(a)})},a.prototype.onQuery=function(a){return j(f).map(function(b){return b.afterQueryInit.subscribe(a)})},a.prototype.onNetworkId=function(a){return j(f).map(function(b){return b.networkIdReceived.subscribe(a)})},a.prototype.onViewSelected=function(a){return g("addEventListener",f).value?e.of(f.value.addEventListener("message",a,!1)):e.of(null)},a.prototype.onExport=function(a){return j(f).map(function(b){return b.exportQueryResult.subscribe(a)})},a.prototype.onClearQuery=function(a){return j(f).map(function(b){return b.clearQuery.subscribe(a)})},a.prototype.loadHistory=function(){return i(f).map(function(a){return a.view.history.doRefreshAll()})},a.prototype.loadQuery=function(a){return i(f).map(function(b){return b.ctrlr.QT.doQueryLoad(a)})},a.prototype.errorDetail=function(a){return k(f).map(function(b){b.plugin.errorDetail(a)})},a.prototype.renameQuery=function(a){return i(f).map(function(b){return b.ctrlr.history.queryRename(a,!1)})},a.prototype.flagQuery=function(a){return i(f).map(function(b){return b.ctrlr.history.Flag({queryId:a,message:""})})},a.prototype.unflagQuery=function(a){return i(f).map(function(b){return b.ctrlr.history.Unflag({queryId:a})})},a.prototype.publishQueryUnavailable=function(){return j(f).map(function(a){return a.queryResultUnavailable.fire()})},a.prototype.publishQueryAvailable=function(){return j(f).map(function(a){return a.queryResultAvailable.fire()})}},f.inject=[window],h=g)),a("I2B2Service",h)}}}),System.register("services/i2b2.pub-sub.js",["./pub-sub","./i2b2.service"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f,g,h,i,j;return{setters:[function(a){f=a.PubSub},function(a){g=a.I2B2Service}],execute:function(){a("I2B2PubSub",(i=h=function(a){function b(e){c(this,b);for(var f=arguments.length,g=Array(f>1?f-1:0),h=1;h<f;h++)g[h-1]=arguments[h];var i=d(this,a.call.apply(a,[this].concat(g)));return i.listen=function(){e.onResize(function(a,b){return b.find(function(a){return"ADD"===a.action})?function(){return i.publish(i.notifications.i2b2.tabMax)}:function(){return i.publish(i.notifications.i2b2.tabMin)}}),e.onHistory(function(){return i.publish(i.notifications.i2b2.historyRefreshed)}),e.onQuery(function(a,b){return i.publish(i.notifications.i2b2.queryStarted,b[0].name)}),e.onNetworkId(function(a,b){return i.publish(i.notifications.i2b2.networkIdReceived,b[0])}),e.onViewSelected(function(a){return i.publish(i.notifications.i2b2.viewSelected,a.data)}),e.onExport(function(){return i.publish(i.notifications.i2b2.exportQuery)}),e.onClearQuery(function(){return i.publish(i.notifications.i2b2.clearQuery)}),i.subscribe(i.commands.i2b2.cloneQuery,function(a){return e.loadQuery(a)}),i.subscribe(i.commands.i2b2.showError,function(a){e.errorDetail(a)}),i.subscribe(i.commands.i2b2.renameQuery,function(a){return e.renameQuery(a)}),i.subscribe(i.commands.i2b2.flagQuery,function(a){return e.flagQuery(a)}),i.subscribe(i.commands.i2b2.unflagQuery,function(a){return e.unflagQuery(a)}),i.subscribe(i.notifications.shrine.queryUnavailable,function(){return e.publishQueryUnavailable()}),i.subscribe(i.notifications.shrine.queryAvailable,function(){return e.publishQueryAvailable()}),i.subscribe(i.notifications.shrine.refreshAllHistory,function(){return e.loadHistory()})},i}return e(b,a),b}(f),h.inject=[g],j=i)),a("I2B2PubSub",j)}}}),System.register("services/query-export.js",["./pub-sub"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f,g,h,i;return{setters:[function(a){f=a.PubSub}],execute:function(){a("QueryExport",g=function(a){function b(){c(this,b);for(var e=arguments.length,f=Array(e),g=0;g<e;g++)f[g]=arguments[g];return d(this,a.call.apply(a,[this].concat(f)))}return e(b,a),b.prototype.listen=function(){this.subscribe(this.commands.shrine.exportResult,h)},b}(f)),a("QueryExport",g),h=function(a){var b=a.nodes.sort(),c=function(a){var b=a.resultType.i2b2Options.description;return b},d=function(a,b){return c(a)<=c(b)?-1:1},e=new Map;b.forEach(function(a){var b=a.breakdowns,c=void 0===b?[]:b;c.sort(d).forEach(function(a){var b,c=a.resultType.i2b2Options.description,d=void 0===c?null:c,f=a.results,g=void 0===f?[]:f;null!==!d&&0!==g.length&&(e.has(d)?(b=e.get(d)).add.apply(b,g.map(function(a){return a.dataKey}).sort()):e.set(d,new Set(g.map(function(a){return a.dataKey}).sort())))})});var f="SHRINE QUERY RESULTS (OBFUSCATED PATIENT COUNTS),"+[""].concat(b.map(function(a){return a.adapterNode}).join(",")),g="\nAll Patients,"+[""].concat(b.map(function(a){return a.count?a.count>0?a.count:0:"unavailable"}).join(",")),h=[];e.forEach(function(a,c){h.push.apply(h,[""].concat(Array.from(a).map(function(a){var d=c.split(" ").shift()+","+a,e=b.map(function(b){var d=b.breakdowns,e=void 0===d?[]:d,f=e.find(function(a){var b=a.resultType.i2b2Options.description;a.results;return b===c}),g=f?f.results.find(function(b){return b.dataKey===a}):void 0;return g?g.value>0?g.value:0:"unavailable"});return d+","+e.join(",")})))});var j=""+f+g+h.join("\n");i(j)},i=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.parent;if(void 0!==b){var c="export.csv",d=new Blob([a]),e=void 0!==b.navigator&&void 0!==b.navigator.msSaveOrOpenBlob;if(e)b.navigator.msSaveBlob(d,c);else{var f=b.parent.document.createElement("a");f.href=b.URL.createObjectURL(d,{type:"text/plain"}),f.download=c,b.document.body.appendChild(f),f.click(),b.document.body.removeChild(f)}}}}}}),System.register("shell.js",["services/i2b2.pub-sub","services/query-export"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.I2B2PubSub},function(a){e=a.QueryExport}],execute:function(){a("Shell",(g=f=function a(b,d){c(this,a),b.listen(),d.listen()},f.inject=[d,e],h=g)),a("Shell",h)}}}),System.register("shell.spec.js",["tape"],function(a,b){var c;return{setters:[function(a){c=a}],execute:function(){c.test("App should exist: ",function(a){a.true(!0),a.end()})}}}),System.register("views/index.js",[],function(a,b){function c(a){var b=["views/query-status/query-status"];a.globalResources.apply(a,b)}return a("configure",c),{setters:[],execute:function(){}}}),function(){var a=System.amdDefine;a("views/query-status/query-status.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div style="height: 100%; overflow: scroll" class="query-status"><div style="display: flex" if.one-way="status.query.queryName"><div style="flex:1">Status of Query ${status.query.queryName | truncate}<br><span if.one-way="nodes.length">at Each Institution: </span><span if.one-way="!nodes.length">${hubMsg}...</span></div><span if.one-way="status.updated">Last Updated on: ${status.updated | dateTime}</span></div><br><node-status repeat.for="node of nodes" result.one-way="node"></node-status><span if.one-way="nodes.length"><br><span>Completed query counts and breakdowns are shown below:</span><br></span><node-result repeat.for="node of nodes" result.one-way="node" query-name.one-way="status.query.queryName"></node-result></div></template>'})}(),System.register("repository/qep.repository.js",["aurelia-fetch-client","fetch"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.HttpClient},function(a){}],execute:function(){e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("QEPRepository",(g=f=function(){function a(b){var d=this;c(this,a),b.configure(function(a){a.useStandardConfiguration().withBaseUrl(d.url).withDefaults({headers:{Authorization:"Basic "+d.auth}})}),this.http=b}return a.prototype.fetchPreviousQueries=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.http.fetch("qep/queryResults?limit="+a+"&skip="+b,{method:"get"}).then(function(a){return a.json()}).catch(function(a){return a})},a.prototype.fetchNetworkId=function(a){return this.http.fetch("qep/networkId?queryName='"+a+"'",{method:"get"}).then(function(a){return a.json()}).catch(function(a){return a})},a.prototype.fetchQuery=function(a,b,c){return this.http.fetch("qep/queryResult/"+a+"?timeoutSeconds="+b+"&afterVersion="+c,{method:"get"}).then(function(a){var b=a.url,c=a.statusText,d=a.status,e=a.ok;return console.log("fetchQuery: "+b+" - "+e+" - "+d+" - "+c),a.json()}).catch(function(a){return a})},a.prototype.fetchStewardEmail=function(){return this.http.fetch("data?key=stewardEmail",{method:"get"}).then(function(a){return a.json()}).then(function(a){return a.indexOf('"')>0?a.split('"')[1]:a}).catch(function(){return""})},e(a,[{key:"url",get:function(){var a=document.URL,b=":6443/shrine-metadata/";return a.substring(0,a.lastIndexOf(":"))+b}},{key:"auth",get:function(){var a=sessionStorage.getItem("shrine.auth");return sessionStorage.removeItem("shrine.auth"),a}}]),a}(),f.inject=[d],h=g)),a("QEPRepository",h)}}}),System.register("services/query-status.model.js",["aurelia-event-aggregator","repository/qep.repository","./shrine.messages"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.EventAggregator},function(a){e=a.QEPRepository},function(a){f=a.commands,g=a.notifications}],execute:function(){h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},a("QueryStatusModel",(j=i=function a(b,d,e){c(this,a);var g=function(a){return b.publish(e.shrine.queryReceived,a)},i=function(a){return new Promise(function(b,c){var d=a.results,e=a.dataVersion,f=a.query,g=function(a,b){return a.adapterNode.toUpperCase()<=b.adapterNode.toUpperCase()?-1:1},i=0===d.length?[]:[].concat(d.sort(g)),j=a.isComplete,k=h({},f,{complete:j});b({query:k,nodes:i,dataVersion:e})})},j=function(a){d.fetchQuery(a.networkId,a.timeoutSeconds,a.dataVersion).then(function(a){return i(a)}).catch(function(a){return console.log("ERROR: "+a)}).then(function(a){return g(a)})},k=function(){b.subscribe(f.shrine.fetchQuery,j)};k()},i.inject=[d,e,g],k=j)),a("QueryStatusModel",k)}}}),System.register("services/shrine.messages.js",[],function(a,b){var c,d;return{setters:[],execute:function(){a("notifications",c={i2b2:{tabMax:"notification.from.i2b2.tab.max",tabMin:"notification.from.i2b2.tab.min",viewSelected:"notification.from.i2b2.tab.selected",historyRefreshed:"notification.from.i2b2.history.refreshed",queryStarted:"notification.from.i2b2.query.started",messageReceived:"notification.from.i2b2.message.received",networkIdReceived:"notification.from.i2b2.networkId.receieved",exportQuery:"notification.from.i2b2.export.query",clearQuery:"notification.from.i2b2.clear.query"},shrine:{queriesReceived:"notification.from.shrine.queries.received",queryReceived:"notification.from.shrine.query.recieved",queryUnavailable:"notification.from.shrine.query.unavailable",queryAvailable:"notification.from.shrine.query.available",refreshAllHistory:"notification.from.shrine.refresh.all.history"}}),a("notifications",c),a("commands",d={i2b2:{cloneQuery:"command.to.i2b2.clone.query",showError:"command.to.i2b2.show.error",flagQuery:"command.to.i2b2.flag.query",unflagQuery:"command.to.i2b2.unflag.query",renameQuery:"command.to.i2b2.rename.query"},shrine:{fetchQuery:"command.to.shrine.fetch.query",exportResult:"command.to.shrine.export.result"}}),a("commands",d)}}}),System.register("services/pub-sub.js",["aurelia-event-aggregator","./shrine.messages"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.EventAggregator},function(a){e=a.commands,f=a.notifications}],execute:function(){a("PubSub",(h=g=function a(b,d,e){c(this,a),this.commands=d,this.notifications=e,this.publish=function(a,c){return b.publish(a,c)},this.subscribe=function(a,c){return b.subscribe(a,c)}},g.inject=[d,e,f],i=h)),a("PubSub",i)}}}),System.register("views/query-status/query-status.js",["aurelia-framework","services/query-status.model","services/pub-sub"],function(a,b){function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,
writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){h=a.customElement,i=a.observable},function(a){j=a.QueryStatusModel},function(a){k=a.PubSub}],execute:function(){a("QueryStatus",(l=h("query-status"),r=l((q=p=function(a){function b(f){d(this,b);for(var g=arguments.length,h=Array(g>1?g-1:0),i=1;i<g;i++)h[i-1]=arguments[i];var j=e(this,a.call.apply(a,[this].concat(h)));return c(j,"nodes",o,j),u.set(j,{isDevEnv:document.location.href.includes("http://localhost:8000/"),exportAvailable:!1}),j}return f(b,a),b.prototype.nodesChanged=function(a,b){return a&&a.length?(u.get(this).exportAvailable=!0,void this.publish(this.notifications.shrine.queryAvailable)):(u.get(this).exportAvailable=!1,void this.publish(this.notifications.shrine.queryUnavailable))},b.prototype.attached=function(){var a=this;this.subscribe(this.notifications.i2b2.queryStarted,function(b){a.status=w().status,a.status.updated=Number(new Date),a.nodes=w().nodes,a.hubMsg=w().hubMsg,a.status.query.queryName=b}),this.subscribe(this.notifications.i2b2.networkIdReceived,function(b){var c=void 0===a.status;c&&(a.status=w().status);var d=b.networkId;a.status.query.networkId=d,a.status.updated=Number(new Date),a.nodes=w().nodes,a.hubMsg=v.RESPONSE_RECEIVED,a.publish(a.commands.shrine.fetchQuery,{networkId:d,timeoutSeconds:s,dataVersion:t})}),this.subscribe(this.notifications.i2b2.exportQuery,function(){var b=a.nodes;a.publish(a.commands.shrine.exportResult,{nodes:b})}),this.subscribe(this.notifications.i2b2.clearQuery,function(){a.nodes=w().nodes,a.status=w().status}),this.subscribe(this.notifications.shrine.queryReceived,function(b){var c=b.query,d=b.nodes,e=b.dataVersion,f=void 0===e?t:e,g=b.query.networkId,h=void 0===g?null:g,i=c.complete,j=void 0!==i&&i,k=s;if(h===a.status.query.networkId){var l=Number(new Date);Object.assign(a.status,{query:c,updated:l}),a.nodes=d,j||a.publish(a.commands.shrine.fetchQuery,{networkId:h,dataVersion:f,timeoutSeconds:k})}}),u.get(this).isDevEnv&&(this.publish(this.notifications.i2b2.queryStarted,"started query"),window.setTimeout(function(){return a.publish(a.notifications.i2b2.networkIdReceived,{networkId:"2421519216383772161",name:"started query"})},2e3))},b}(k),p.inject=[j],n=q,o=g(n.prototype,"nodes",[i],{enumerable:!0,initializer:null}),m=n))||m)),a("QueryStatus",r),s=15,t=-1,u=new WeakMap,v={WAITING_ON_RESPONSE:"Waiting on response from network",RESPONSE_RECEIVED:"Response received from network.  Waiting on results"},w=function(a){return{status:{query:{networkId:null,queryName:null,updated:null,complete:!1}},nodes:[],hubMsg:v.WAITING_ON_RESPONSE}}}}});